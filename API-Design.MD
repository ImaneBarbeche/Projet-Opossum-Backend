# ğŸš€ OPOSSUM API - Architecture Monolithique

## ğŸ“‹ Vue d'ensemble

API REST pour l'application OPOSSUM de signalement d'objets perdus/trouvÃ©s, basÃ©e sur **UNE SEULE application Spring Boot** - Architecture monolithique pour simplicitÃ© et rapiditÃ© de dÃ©veloppement.

---

## ğŸ—ï¸ Architecture SimplifiÃ©e

### Une seule application Spring Boot (Port: 8080)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         OPOSSUM API (Spring Boot)       â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚          CONTROLLERS                â”‚â”‚
â”‚  â”‚  â€¢ AuthController                   â”‚â”‚
â”‚  â”‚  â€¢ UserController                   â”‚â”‚
â”‚  â”‚  â€¢ AnnonceController                â”‚â”‚
â”‚  â”‚  â€¢ MessageController                â”‚â”‚
â”‚  â”‚  â€¢ FileController                   â”‚â”‚
â”‚  â”‚  â€¢ AdminController                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚           SERVICES                  â”‚â”‚
â”‚  â”‚  â€¢ UserService                      â”‚â”‚
â”‚  â”‚  â€¢ AnnonceService                   â”‚â”‚
â”‚  â”‚  â€¢ MessageService                   â”‚â”‚
â”‚  â”‚  â€¢ FileService                      â”‚â”‚
â”‚  â”‚  â€¢ EmailService                     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚         REPOSITORIES                â”‚â”‚
â”‚  â”‚  â€¢ UserRepository                   â”‚â”‚
â”‚  â”‚  â€¢ AnnonceRepository                â”‚â”‚
â”‚  â”‚  â€¢ MessageRepository                â”‚â”‚
â”‚  â”‚  â€¢ FileRepository                   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  PostgreSQL Database â”‚
        â”‚     opossum_db      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Avantages pour vous :**
- âœ… **Un seul projet** Ã  gÃ©rer
- âœ… **Une seule base de donnÃ©es**
- âœ… **Pas de communication rÃ©seau** entre services
- âœ… **DÃ©bogage plus simple**
- âœ… **DÃ©ploiement plus facile**

---

## ğŸ” Authentification & SÃ©curitÃ©

### JWT Tokens (comme prÃ©vu)
- **Access Token** : 30 minutes
- **Refresh Token** : 7 jours
- Stockage en base de donnÃ©es

### RÃ´les
- `USER` : utilisateur standard
- `ADMIN` : administrateur/modÃ©rateur

---

## ğŸ“Š Endpoints API SimplifiÃ©s

### ğŸ”‘ Authentification - `/api/v1/auth`
```http
POST /api/v1/auth/register
POST /api/v1/auth/login
POST /api/v1/auth/refresh
POST /api/v1/auth/logout
POST /api/v1/auth/forgot-password
POST /api/v1/auth/reset-password
```

### ğŸ‘¤ Utilisateurs - `/api/v1/users`
```http
GET    /api/v1/users/profile          # Mon profil
PUT    /api/v1/users/profile          # Modifier mon profil
DELETE /api/v1/users/profile          # Supprimer mon compte
GET    /api/v1/users/{id}             # Profil public
```

### ğŸ“£ Annonces - `/api/v1/annonces`
```http
GET    /api/v1/annonces               # Liste avec filtres
POST   /api/v1/annonces               # CrÃ©er
GET    /api/v1/annonces/{id}          # DÃ©tail
PUT    /api/v1/annonces/{id}          # Modifier
DELETE /api/v1/annonces/{id}          # Supprimer
GET    /api/v1/annonces/search        # Recherche
```

### ğŸ’¬ Messages - `/api/v1/conversations`
```http
GET    /api/v1/conversations          # Mes conversations
POST   /api/v1/conversations          # Nouvelle conversation
GET    /api/v1/conversations/{id}/messages  # Messages
POST   /api/v1/conversations/{id}/messages  # Envoyer message
```

### ğŸ“ Fichiers - `/api/v1/files`
```http
POST   /api/v1/files/upload           # Upload photo
GET    /api/v1/files/{id}             # TÃ©lÃ©charger
```

### ğŸ“ˆ Admin - `/api/v1/admin` (Optionnel pour v1)
```http
GET    /api/v1/admin/stats            # Statistiques
GET    /api/v1/admin/users            # Gestion utilisateurs
GET    /api/v1/admin/annonces         # ModÃ©ration annonces
```

---

## ğŸ—„ï¸ Base de DonnÃ©es SimplifiÃ©e

### Une seule base : `opossum_db`

#### Tables principales :
```sql
-- Utilisateurs
users (id, email, password, first_name, last_name, phone, role, created_at)

-- Tokens de refresh
refresh_tokens (id, user_id, token, expires_at)

-- Annonces
annonces (id, title, description, type, category, status, 
          latitude, longitude, address, city, user_id, created_at)

-- Photos des annonces
annonce_photos (id, annonce_id, file_path, is_primary)

-- Conversations
conversations (id, annonce_id, user1_id, user2_id, created_at)

-- Messages
messages (id, conversation_id, sender_id, content, sent_at, is_read)

-- Fichiers uploadÃ©s
files (id, original_name, file_path, mime_type, user_id, created_at)
```

**Beaucoup plus simple !** Toutes les donnÃ©es dans une seule base.

---

## ğŸš€ Plan de dÃ©veloppement par Ã©tapes

### Phase 1 : Base (1 semaine)
1. **Setup projet Spring Boot**
   - Spring Web, Security, JPA, PostgreSQL
   - Configuration de base

2. **Authentification**
   - Inscription/Connexion
   - JWT tokens
   - SÃ©curisation des endpoints

3. **CRUD Utilisateurs**
   - Profil utilisateur
   - Gestion de compte

### Phase 2 : FonctionnalitÃ©s principales (1 semaine)
1. **CRUD Annonces**
   - CrÃ©er/modifier/supprimer annonces
   - GÃ©olocalisation basique

2. **Upload de photos**
   - Stockage local des fichiers
   - Association aux annonces

3. **Recherche simple**
   - Filtrage par type (LOST/FOUND)
   - Recherche par ville

### Phase 3 : FonctionnalitÃ©s avancÃ©es (1 semaine)
1. **Messagerie basique**
   - Conversations entre utilisateurs
   - CRUD messages

2. **Recherche gÃ©ographique**
   - Recherche par proximitÃ©
   - Calcul de distance

3. **Interface admin basique**
   - Statistiques simples
   - ModÃ©ration

---

## ğŸ› ï¸ Technologies recommandÃ©es

### Backend
```xml
<!-- pom.xml simplifiÃ© -->
<dependencies>
    <!-- Spring Boot Starter Web -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    
    <!-- Spring Security -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-security</artifactId>
    </dependency>
    
    <!-- Spring Data JPA -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-jpa</artifactId>
    </dependency>
    
    <!-- PostgreSQL -->
    <dependency>
        <groupId>org.postgresql</groupId>
        <artifactId>postgresql</artifactId>
    </dependency>
    
    <!-- JWT -->
    <dependency>
        <groupId>io.jsonwebtoken</groupId>
        <artifactId>jjwt-api</artifactId>
        <version>0.11.5</version>
    </dependency>
    
    <!-- Validation -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-validation</artifactId>
    </dependency>
</dependencies>
```

### Structure du projet
```
src/main/java/com/opossum/
â”œâ”€â”€ OpossumApplication.java
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ SecurityConfig.java
â”‚   â””â”€â”€ JwtConfig.java
â”œâ”€â”€ controller/
â”‚   â”œâ”€â”€ AuthController.java
â”‚   â”œâ”€â”€ UserController.java
â”‚   â”œâ”€â”€ AnnonceController.java
â”‚   â””â”€â”€ MessageController.java
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ UserService.java
â”‚   â”œâ”€â”€ AnnonceService.java
â”‚   â””â”€â”€ MessageService.java
â”œâ”€â”€ repository/
â”‚   â”œâ”€â”€ UserRepository.java
â”‚   â”œâ”€â”€ AnnonceRepository.java
â”‚   â””â”€â”€ MessageRepository.java
â”œâ”€â”€ entity/
â”‚   â”œâ”€â”€ User.java
â”‚   â”œâ”€â”€ Annonce.java
â”‚   â””â”€â”€ Message.java
â””â”€â”€ dto/
    â”œâ”€â”€ UserDTO.java
    â”œâ”€â”€ AnnonceDTO.java
    â””â”€â”€ MessageDTO.java
```

---

## ğŸ¯ Avantages de cette approche

### Pour l'apprentissage
- âœ… **Focus sur la logique mÃ©tier** plutÃ´t que sur l'infrastructure
- âœ… **Concepts Spring Boot classiques**
- âœ… **Debugging facile** - tout dans un seul processus
- âœ… **Tests plus simples**

### Pour le dÃ©veloppement
- âœ… **DÃ©veloppement plus rapide**
- âœ… **Moins de configuration**
- âœ… **DÃ©ploiement simple** (un seul JAR)
- âœ… **Base solide** pour Ã©voluer vers les microservices plus tard

### Pour le projet
- âœ… **Respecte le brief** (Spring Boot + PostgreSQL + JWT)
- âœ… **Toutes les fonctionnalitÃ©s** demandÃ©es
- âœ… **Temps de dÃ©veloppement rÃ©aliste**
- âœ… **Moins de risques techniques**

---

## ğŸ”„ Migration future possible

Si plus tard vous voulez passer aux microservices, cette architecture monolithique sera une excellente base :

1. **User Service** = Package `user` + table `users`
2. **Annonce Service** = Package `annonce` + tables `annonces` + `annonce_photos`
3. **Message Service** = Package `message` + tables `conversations` + `messages`

**Conclusion :** Commencez simple, apprenez bien les bases, et Ã©voluez progressivement ! ğŸ“
